story:
  id: "STORY-005"
  title: "Implement Priority System"
  epic: "EPIC-002"
  created: "2025-07-15 09:35:00"
  created_by: "@PM"
  assigned_to: "@PM"
  priority: "P0"  # Critical - system unusable without proper priorities
  status: "TRIAGED"
  phase: "PLAN"
  
problem_description: |
  The system currently treats the LAST item as highest priority, which is
  conceptually and contextually wrong. We need a proper priority system
  that flows from Epic → Story/Bug → Task with clear execution order.
  
acceptance_criteria:
  - Priority levels defined for epics, stories/bugs, and tasks
  - Priority inheritance from parent items
  - Execution follows priority order (P0 first, not last)
  - Commands show items sorted by priority
  - Dynamic priority adjustment supported
  
embedded_config:
  # From config.md - ALL settings that affect priority system
  autonomy_level: "L3"
  pm_always_active: true
  memory_integration: true
  blocking_enabled: false  # Affects review task priority
  git_privacy: true
  requirements_engineer_mandatory: true  # Affects task creation
  architecture_review_required: true  # Creates high-priority review tasks
  enforce_peer_review: true  # Creates review tasks
  testing_required: true  # Creates test tasks
  security_validation: true  # Creates P0 security tasks
  
workflow_references:
  outer_workflow: "workflow-templates/outer-workflow-corrected.yaml"
  inner_workflow: "workflow-templates/inner-workflow-corrected.yaml"
  priority_system: "src/planning/priority-system.md"
  
integration_requirements:
  - Priority must flow: Epic → Story/Bug → Task
  - P0 executes first, not last
  - Blocking tasks before parallel tasks
  - Security issues always P0
  - Customer bugs escalate priority
  
technical_references:
  - Current wrong behavior: Last item = highest priority
  - Correct behavior: P0 → P1 → P2 → P3
  - Task priority types: blocking, critical_path, parallel, optional
  - Bug severity mapping: CRITICAL→P0, HIGH→P1, MEDIUM→P2, LOW→P3
  
tasks:
  - id: "TASK-001"
    title: "Design Priority System Architecture"
    type: "architecture_design"
    assigned_to: "@AI-Architect"
    priority: "blocking"
    estimated_hours: 2
    status: "planned"
    description: "Define priority levels, inheritance rules, and execution order logic"
    
  - id: "TASK-002"
    title: "Implement Priority Logic in Lean Workflow Executor"
    type: "implementation"
    assigned_to: "@AI-Engineer"
    priority: "critical_path"
    dependencies: ["TASK-001"]
    estimated_hours: 3
    status: "planned"
    description: "Add priority sorting functions and fix execution order (P0 first, not last)"
    
  - id: "TASK-003"
    title: "Update Workflow Templates with Priority Support"
    type: "implementation"
    assigned_to: "@AI-Engineer"
    priority: "critical_path"
    dependencies: ["TASK-002"]
    estimated_hours: 2
    status: "planned"
    description: "Add priority sorting to workflows and TodoWrite integration"
    
  - id: "TASK-004"
    title: "Test Priority System"
    type: "testing"
    assigned_to: "@QA-Engineer"
    priority: "critical_path"
    dependencies: ["TASK-003"]
    estimated_hours: 2
    status: "planned"
    description: "Verify P0 executes before P1/P2/P3 and test priority inheritance"
    
  - id: "TASK-005"
    title: "Update Documentation"
    type: "documentation"
    assigned_to: "@AI-Engineer"
    priority: "parallel"
    dependencies: ["TASK-004"]
    estimated_hours: 1
    status: "planned"
    description: "Document priority system design and usage guidelines"
    
  - id: "TASK-006"
    title: "Deploy Priority System"
    type: "deployment"
    assigned_to: "@DevOps-Engineer"
    priority: "critical_path"
    dependencies: ["TASK-004"]
    estimated_hours: 1
    status: "planned"
    description: "Deploy priority system with proper execution order fix"
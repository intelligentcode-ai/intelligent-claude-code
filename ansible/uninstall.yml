---
# Intelligent Claude Code - Uninstall Playbook
# Runs from control machine, uninstalls from targets via SSH
# NO Ansible required on target machines!

- name: Uninstall Intelligent Claude Code
  hosts: all
  gather_facts: true
  vars:
    target_path: "{{ target_path | default('') }}"

  tasks:
    - name: Determine uninstall scope and path
      ansible.builtin.set_fact:
        intelligent_claude_code_uninstall_target_scope: "{{ 'project' if target_path else 'user' }}"
        intelligent_claude_code_uninstall_install_path: "{{ (target_path | realpath) + '/.claude' if target_path else ansible_env.HOME + '/.claude' }}"
        intelligent_claude_code_uninstall_project_path: "{{ target_path | realpath if target_path else '' }}"

    - name: Display uninstall target
      ansible.builtin.debug:
        msg: "Uninstalling from: {{ intelligent_claude_code_uninstall_install_path }}"

    - name: Include intelligent_claude_code uninstall role
      ansible.builtin.include_role:
        name: intelligent_claude_code_uninstall
      vars:
        intelligent_claude_code_uninstall_install_path: "{{ intelligent_claude_code_uninstall_install_path }}"
        intelligent_claude_code_uninstall_project_path: "{{ intelligent_claude_code_uninstall_project_path }}"
        intelligent_claude_code_uninstall_scope: "{{ intelligent_claude_code_uninstall_target_scope }}"
        intelligent_claude_code_uninstall_force_remove: "{{ force | default(false) }}"

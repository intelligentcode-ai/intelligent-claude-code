---
# Process MCP configuration with environment variable resolution

- name: Initialize processed MCP servers
  ansible.builtin.set_fact:
    mcp_integration_processed_servers: {}

- name: Process each MCP server configuration
  ansible.builtin.include_tasks: process_single_mcp.yml
  loop: "{{ mcp_integration_config_data.mcpServers | dict2items }}"
  loop_control:
    loop_var: mcp_integration_server

- name: Validate processed configuration
  ansible.builtin.fail:
    msg: "No MCP servers were processed successfully"
  when: mcp_integration_processed_servers | length == 0

- name: Log processing results
  ansible.builtin.debug:
    msg: "Successfully processed {{ mcp_integration_processed_servers | length }} MCP servers"
